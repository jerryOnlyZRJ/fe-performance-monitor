/**
 * fe-performance-monitor v1.0.0
 * Copyright 2018-2019 Ranjay
 * Released under the MIT License
 * https://github.com/jerryOnlyZRJ/fe-performance-monitor#readme
 */
!function(t,e){"undefined"==typeof module?t.PerformanceMonitor=e():module.exports=e()}(this,function(){"use strict";var l="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};var t,r=(function(d){!function(){var o="undefined"!=typeof window&&window===this?this:void 0!==l&&null!=l?l:this,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)};function n(){n=function(){},o.Symbol||(o.Symbol=t)}var r=0;function t(t){return"jscomp_symbol_"+(t||"")+r++}function i(){n();var t=o.Symbol.iterator;t||(t=o.Symbol.iterator=o.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&e(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return a(this)}}),i=function(){}}function a(t){var e,n=0;return e=function(){return n<t.length?{done:!1,value:t[n++]}:{done:!0}},i(),(e={next:e})[o.Symbol.iterator]=function(){return this},e}function f(t){i();var e=t[Symbol.iterator];return e?e.call(t):a(t)}function p(t){if(!(t instanceof Array)){t=f(t);for(var e,n=[];!(e=t.next()).done;)n.push(e.value);t=n}return t}var m=0;var h="img script iframe link audio video source".split(" ");function v(t,e){for(var n=(t=f(t)).next();!n.done;n=t.next())if(n=n.value,e.includes(n.nodeName.toLowerCase())||v(n.children,e))return!0;return!1}function y(t,e){if(2<t.length)return performance.now();for(var n=[],o=(e=f(e)).next();!o.done;o=e.next())o=o.value,n.push({timestamp:o.start,type:"requestStart"}),n.push({timestamp:o.end,type:"requestEnd"});for(o=(e=f(t)).next();!o.done;o=e.next())n.push({timestamp:o.value,type:"requestStart"});for(n.sort(function(t,e){return t.timestamp-e.timestamp}),t=t.length,e=n.length-1;0<=e;e--)switch((o=n[e]).type){case"requestStart":t--;break;case"requestEnd":if(2<++t)return o.timestamp;break;default:throw Error("Internal Error: This should never happen")}return 0}function s(t){t=t||{},this.w=!!t.useMutationObserver,this.u=t.minValue||null,t=window.__tti&&window.__tti.e;var i,a,s,u,c,d,l,o,n,e,r=window.__tti&&window.__tti.o;this.a=t?t.map(function(t){return{start:t.startTime,end:t.startTime+t.duration}}):[],r&&r.disconnect(),this.b=[],this.f=new Map,this.j=null,this.v=-1/0,this.i=!1,this.h=this.c=this.s=null,i=this.m.bind(this),a=this.l.bind(this),s=XMLHttpRequest.prototype.send,u=m++,XMLHttpRequest.prototype.send=function(t){for(var e=arguments,n=[],o=0;o<arguments.length;++o)n[o-0]=e[o];var r=this;return i(u),this.addEventListener("readystatechange",function(){4===r.readyState&&a(u)}),s.apply(this,n)},c=this.m.bind(this),d=this.l.bind(this),l=fetch,fetch=function(t){for(var e=arguments,r=[],n=0;n<arguments.length;++n)r[n-0]=e[n];return new Promise(function(e,n){var o=m++;c(o),l.apply(null,[].concat(p(r))).then(function(t){d(o),e(t)},function(t){d(t),n(t)})})},(o=this).c=new PerformanceObserver(function(t){for(var e=(t=f(t.getEntries())).next();!e.done;e=t.next())if("resource"===(e=e.value).entryType&&(o.b.push({start:e.fetchStart,end:e.responseEnd}),w(o,y(o.g,o.b)+5e3)),"longtask"===e.entryType){var n=e.startTime+e.duration;o.a.push({start:e.startTime,end:n}),w(o,n+5e3)}}),o.c.observe({entryTypes:["longtask","resource"]}),this.w&&(this.h=(n=this.B.bind(this),(e=new MutationObserver(function(t){for(var e=(t=f(t)).next();!e.done;e=t.next())"childList"==(e=e.value).type&&v(e.addedNodes,h)?n(e):"attributes"==e.type&&h.includes(e.target.tagName.toLowerCase())&&n(e)})).observe(document,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["href","src"]}),e))}function u(t){t.i=!0;var e=0<t.a.length?t.a[t.a.length-1].end:0,n=y(t.g,t.b);w(t,Math.max(n+5e3,e))}function w(i,t){!i.i||i.v>t||(clearTimeout(i.j),i.j=setTimeout(function(){var t=performance.timing.navigationStart,e=y(i.g,i.b);t=(window.a&&window.a.A?1e3*window.a.A().C-t:0)||performance.timing.domContentLoadedEventEnd-t;if(i.u)var n=i.u;else n=performance.timing.domContentLoadedEventEnd?(n=performance.timing).domContentLoadedEventEnd-n.navigationStart:null;var o=performance.now();null===n&&w(i,Math.max(e+5e3,o+1e3));var r=i.a;(e=o-e<5e3?null:o-(e=r.length?r[r.length-1].end:t)<5e3?null:Math.max(e,n))&&(i.s(e),clearTimeout(i.j),i.i=!1,i.c&&i.c.disconnect(),i.h&&i.h.disconnect()),w(i,performance.now()+1e3)},t-performance.now()),i.v=t)}s.prototype.getFirstConsistentlyInteractive=function(){var e=this;return new Promise(function(t){e.s=t,"complete"==document.readyState?u(e):window.addEventListener("load",function(){u(e)})})},s.prototype.m=function(t){this.f.set(t,performance.now())},s.prototype.l=function(t){this.f.delete(t)},s.prototype.B=function(){w(this,performance.now()+5e3)},o.Object.defineProperties(s.prototype,{g:{configurable:!0,enumerable:!0,get:function(){return[].concat(p(this.f.values()))}}});var c={getFirstConsistentlyInteractive:function(t){return t=t||{},"PerformanceLongTaskTiming"in window?new s(t).getFirstConsistentlyInteractive():Promise.resolve(null)}};d.exports?d.exports=c:window.ttiPolyfill=c}()}(t={exports:{}},t.exports),t.exports),i=new Map;i.set("resource",function(t){return{rtt:t.responseStart-t.startTime,name:t.name,duration:t.duration}}),i.set("paint",function(t){return{name:t.name,startTime:t.startTime}}),i.set("mark",function(t){return{name:t.name,startTime:t.startTime,duration:t.duration}}),i.set("navigation",function(t){return{name:t.name,rtt:t.responseStart,domContentLoaded:t.domContentLoadedEventEnd,domComplete:t.domComplete}}),i.set("longtask",function(t){return t});var e=function(t){this.options=t,this.monitorResult={}};return e.prototype.uploadMonitorLogs=function(){if(navigator.sendBeacon&&"function"==typeof navigator.sendBeacon){var t=new window.Blob([JSON.stringify(this.monitorResult)],{type:"application/json"});navigator.sendBeacon(this.options.url,t)}else fetch in window?window.fetch(this.options.url,{method:"POST",body:JSON.stringify(this.monitorResult)}):console.log(this.monitorResult)},e.prototype.init=function(){var e=this,n=new window.PerformanceObserver(function(t){t.getEntries().map(function(t){e.monitorResult[t.entryType]?e.monitorResult[t.entryType].push(i.get(t.entryType)(t)):e.monitorResult[t.entryType]=[i.get(t.entryType)(t)]}),e.monitorResult.resource&&e.monitorResult.resource.sort(function(t,e){return e.duration-t.duration}),n.disconnect()});n.observe({entryTypes:["resource","mark","paint","navigation","longtask"]}),r.getFirstConsistentlyInteractive({}).then(function(t){e.monitorResult.navigation&&e.monitorResult.navigation.push({name:"time-to-interactive",startTime:t})});var o=window.onload;window.onload=function(t){o&&"function"==typeof o&&o(t),window.requestIdleCallback?window.requestIdleCallback(e.uploadMonitorLogs.bind(e)):setTimeout(e.uploadMonitorLogs.bind(e))}},e});